{% extends 'base.html' %}
{% load i18n %}
{% load static %}

{% block title %}{% trans "みんなの日記| Enjoy Language" %}{% endblock %}

{% block active_diary_list1 %}active{% endblock %}

{% block head %}
<link href="{% static 'css/clean-blog.min.css' %}" rel="stylesheet">
{% endblock %}

{% block contents %}
<div class="container">
    <div class="row">
        <div class="my-div-style w-100">
            <div class="col-lg-8 col-md-10 mx-auto">
                <div class="clearfix">
                    <a class="btn btn-primary float-right my-3" href="{% url 'diary:diary_create' %}">{% trans "日記を書く" %}</a>
                </div>
                <!-- 日記リスト -->
                {% for diary, comments_list in items %}
                  <div class="card" >
                    <!-- 投稿者の情報 -->
                    <div class="card-header bg-transparent border-bottom-0">
                      <div class="row">
                        <div class="col-auto">
                          <a  href="{% url 'pages:profile' diary.user.pk %}">
                            {% if diary.user.profile_photo %}
                                <img class="rounded-circle" src="{{ diary.user.profile_photo.url }}" width="50" height="50"/>
                            {% endif %}
                          </a>
                        </div>
                        <div class="col">
                          <div class="row">
                            <div class="col-auto">
                              <b>{{ diary.user.nickname }}</b>
                            </div>
                            <div class="col">
                              <b>{{ diary.user.get_mother_language_display }}→{{ diary.user.get_learn_language_display }}</b>
                            </div>
                          </div>
                          <!-- 日記の更新日時 -->
                          <div class="row">
                            <div class="col">
                              <small>{{ diary.updated_at }}</small>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="card-body">
                      <!-- 日記のテキスト情報（タイトルはなし）　抜粋 -->
                      <p class="card-text">{{ diary.content|truncatechars:100 }}</p>
                    </div>
                    <!-- 日記写真（あれば表示、最大3） -->
                    {% if diary.photo1 %}
                      <div class="row text-center align-items-center px-1">
                        <div class="col">
                          <img src="{{ diary.photo1.url }}" class="img-fluid"/>
                        </div>
                        {% if diary.photo2 %}
                          <div class="col">
                            <img src="{{ diary.photo2.url }}" class="img-fluid"/>
                          </div>
                          {% if diary.photo3 %}
                            <div class="col">
                              <img src="{{ diary.photo3.url }}" class="img-fluid"/>
                            </div>
                          {% endif %}
                        {% endif %}
                      </div>
                    {% endif %}

                    <!-- 日記リストフッター -->
                    <div class="card-footer bg-transparent border-top-0">
                      <div class="row d-flex align-items-center">
                        <!-- いいね、コメント数 -->
                        <div class="col-auto" id="like">
                            {% include 'diary/like.html' %}
                        </div>
                        <div class="col text-left">
                          <button class="btn btn-light border-secondary" name="num_comment">{% trans "コメント" %} <span class="badge badge-light">{{ comments_list|length}}</span></button>
                        </div>
                      </div>
                      <!-- コメントリスト -->
                      {% if comments_list %}
                      <div class="row mt-2 py-2 border-top">
                        コメント
                      </div>
                      {% endif %}
                      {% for comment in comments_list %}
                      <div class="row pt-2">
                        <!-- コメントユーザー写真 -->
                        <div class="col-auto">
                          <a href="{% url 'pages:profile' comment.user.pk %}">
                            {% if comment.user.profile_photo %}
                                <img class="rounded-circle" src="{{ comment.user.profile_photo.url }}" width="50" height="50"/>
                            {% endif %}
                          </a>
                        </div>
                        <div class="col">
                          <div class="row">
                            <div class="col-auto">
                              <b>{{ comment.user.nickname }}</b>
                            </div>
                            <!-- コメント日時 -->
                            <div class="col">
                              <small>{{ comment.created_at }}</small>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="row border-bottom  pb-3">
                        <div class="col">
                          <!-- コメントのテキスト情報　抜粋 -->
                          <p>{{ comment.comment_content|truncatechars:300 }}</p>
                        </div>
                        <!-- コメント写真（あれば表示） -->
                        {% if comment.photo %}
                          <div class="row align-items-center px-1">
                            <div class="col">
                              <img src="{{ comment.photo.url }}" class="img-fluid" width="200" height="200"/>
                            </div>
                          </div>
                        {% endif %}
                      </div>
                    {% endfor %}
                    </div>
                  </div>
                  <hr>
                {% empty %}
                    <p>{% trans "日記がありません。" %}</p>
                {% endfor %}

                <!-- ページネーション処理 -->
                {% for post in post_list %}
        <p>{{ post.title }}</p>
    {% endfor %}
                {% include 'diary/pagination.html' %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
