{% extends 'base.html' %}
{% load i18n %}
{% load static %}

{% block title %}{% trans "ユーザー検索| Enjoy Language" %}{% endblock %}

{% block active_diary_list %}active{% endblock %}

{% block head %}
<link href="{% static 'css/clean-blog.min.css' %}" rel="stylesheet">
{% endblock %}

{% block contents %}
<div class="container">
    <div class="row">
        <div class="my-div-style w-100">
            <div class="col-lg-8 col-md-10 mx-auto">
              <div class="row mt-5 mb-5 align-items-center">
                <div class="col">
                  <button id="ajax-user_search_all" class="btn btn-dark border-secondary" type="submit" >{% trans "全ユーザー" %}</button>
                </div>
                <div class="col">
                  <button id="ajax-user_search_mother" class="btn btn-light border-secondary" type="submit" >{% trans "学習を手伝おう" %}</button>
                </div>
                <div class="col">
                  <button id="ajax-user_search_learn" class="btn btn-light border-secondary" type="submit" >{% trans "学習仲間" %}</button>
                </div>
              </div>
              <div class="post-preview" id="user_search">
                {% for user_item in user_search %}
                <a class="nav-link" href="{% url 'pages:profile' user_item.pk %}"></a>
                  <p>
                  {% if user_item.profile_photo %}
                      <img src="{{ user_item.profile_photo.url }}" width="50" height="50"/>
                  {% endif %}
                  {{ user_item.nickname }}　{{ user_item.age }}　{{ user_item.get_mother_language_display }}→{{ user_item.get_learn_language_display }}</p>
                  <hr>
                  {% empty %}
                      <p>{% trans "該当するユーザーがいません。" %}</p>
                  {% endfor %}
                  <!-- ページネーション処理 -->
                  {% if is_paginated %}
                      <ul class="pagination">
                          <!-- 前ページへのリンク -->
                          {% if page_obj.has_previous %}
                              <li class="page-item">
                                  <a class="page-link" href="?page={{ page_obj.previous_page_number }}">
                                      <span aria-hidden="true">&laquo;</span>
                                  </a>
                              </li>
                          {% endif %}

                          <!-- ページ数表示 -->
                          {% for page_num in page_obj.paginator.page_range %}
                              {% if page_obj.number == page_num %}
                                  <li class="page-item active"><a class="page-link" href="#">{{ page_num }}</a></li>
                              {% else %}
                                  <li class="page-item"><a class="page-link" href="?page={{ page_num }}">{{ page_num }}</a></li>
                              {% endif %}
                          {% endfor %}

                          <!-- 次ページへのリンク -->
                          {% if page_obj.has_next %}
                              <li class="page-item">
                                  <a class="page-link" href="?page={{ page_obj.next_page_number }}">
                                      <span aria-hidden="true">&raquo;</span>
                                  </a>
                              </li>
                          {% endif %}
                      </ul>
                  {% endif %}
              </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extrajs %}
<script type="text/javascript">

  const button_all = document.getElementById('ajax-user_search_all');
  const button_mother = document.getElementById('ajax-user_search_mother');
  const button_learn = document.getElementById('ajax-user_search_learn');

  //ユーザー検索（すべてのユーザー）
  // 送信ボタンで呼ばれる
  $('#ajax-user_search_all').click(function(e) {
  // デフォルトのイベントをキャンセルし、ページ遷移しないように!
    e.preventDefault();
    button_all.className = "btn btn-dark border-secondary";
    button_mother.className = "btn btn-light border-secondary";
    button_learn.className = "btn btn-light border-secondary";

    $.ajax({
        'url': '{% url "pages:ajax_usersearchall" %}',
        'type': 'GET',
    }).done( response => {
      console.log(response.user_list);
      // 記事欄を真っ白にする。
      $('#user_search').empty();

      for (const user of response.user_list) {
        // htmlを追加
        // もし写真があるならば写真追加
        if(user.profile_photo_url) {
          const user_list = `
            <div class="info">
                <p>
                  <img src="${user.profile_photo_url}" width="50" height="50">  ${user.name}  ${user.ange}  ${user.mother_language}→${user.learn_language}
                </p>
            </div>
            <hr>`;
            $('#user_search').append(user_list);
        }
        else {
          const user_list = `
          <div class="info">
              <p>
                 ${user.name}  ${user.ange}  ${user.mother_language}→${user.learn_language}
              </p>
          </div>
          `;
          $('#user_search').append(user_list);
        }

        console.log(user);
      }
    });
  });

  //ユーザー検索（学習を手伝う：母語＝学習言語）
  // 送信ボタンで呼ばれる
  $('#ajax-user_search_mother').click(function(e) {
    // デフォルトのイベントをキャンセルし、ページ遷移しないように!
    e.preventDefault();
    button_mother.className = "btn btn-dark border-secondary";
    button_all.className = "btn btn-light border-secondary";
    button_learn.className = "btn btn-light border-secondary";

    $.ajax({
        'url': '{% url "pages:ajax_usersearchmother" %}',
        'type': 'GET',
    }).done( response => {
      console.log(response.user_list);
      // 記事欄を真っ白にする。
      $('#user_search').empty();

     for (const user of response.user_list) {
       // htmlを追加
        // もし写真があるならば写真追加
        if(user.profile_photo_url) {
            const user_list = `

            <div class="info">
                <p>
                  <img src="${user.profile_photo_url}" width="50" height="50">  ${user.name}  ${user.ange}  ${user.mother_language}→${user.learn_language}
                </p>
            </div>
            <hr>`;
            $('#user_search').append(user_list);
        }
        else {
          const user_list = `
          <div class="info">
              <p>
                 ${user.name}  ${user.ange}  ${user.mother_language}→${user.learn_language}
              </p>
          </div>
          `;
          $('#user_search').append(user_list);
        }

        console.log(user);
      }
    });
  });

  //ユーザー検索（学習仲間：学習言語＝学習言語）
  // 送信ボタンで呼ばれる
  $('#ajax-user_search_learn').click(function(e) {
      // デフォルトのイベントをキャンセルし、ページ遷移しないように!
      e.preventDefault();
      button_learn.className = "btn btn-dark border-secondary";
      button_all.className = "btn btn-light border-secondary";
      button_mother.className = "btn btn-light border-secondary";

      $.ajax({
          'url': "{% url 'pages:ajax_usersearchlearn' %}",
          'type': 'GET',
      }).done( response => {
        console.log(response.user_list);
        // 記事欄を真っ白にする。
        $('#user_search').empty();

     for (const user of response.user_list) {
       // htmlを追加
        // もし写真があるならば写真追加
        if(user.profile_photo_url) {
            const user_list = `

            <div class="info">
                <p>
                  <img src="${user.profile_photo_url}" width="50" height="50">  ${user.name}  ${user.ange}  ${user.mother_language}→${user.learn_language}
                </p>
            </div>
            <hr>`;
            $('#user_search').append(user_list);
        }
        else {
          const user_list = `
          <div class="info">
              <p>
                 ${user.name}  ${user.ange}  ${user.mother_language}→${user.learn_language}
              </p>
          </div>
          `;
          $('#user_search').append(user_list);
        }
        console.log(user);
      }
    });
  });


</script>
{% endblock %}
