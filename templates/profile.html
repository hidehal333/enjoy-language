{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "プロフィール | Enjoy Language" %}{% endblock %}
{% block active_profile %}active{% endblock %}

{% block head %}
<link href="{% static 'css/clean-blog.min.css' %}" rel="stylesheet">
{% endblock %}

{% block contents %}
<div class="container">
  <div class="row">
    <div class="my-div-style w-100">
      <div class="col-lg-8 col-md-10 mx-auto">
        {% if request.user.id == object_id %}
        <div class="clearfix">
          <a class="btn btn-primary float-right" href="{% url 'pages:profile_change' %}">{% trans "プロフィールを編集" %}</a>
                </div>
        {% endif %}
        <div class="row">
          <div class="col">
            {% for profile in profile_list %}
              {% if profile.profile_photo %}
                <img class="rounded-circle" src="{{ profile.profile_photo.url }}" width="200" height="200"/>
              {% endif %}
          </div>
          <div class="col mt-3">
            <small>{% trans "登録日: " %}{{ profile.date_joined }}</small>
          </div>
        </div>
          <div class="row my-3">
            <div class="col">{% trans "名前: " %}{{ profile.nickname }}　　{{ profile.get_gender_display }}</div>
          </div>
          <div class="row my-2">
            <div class="col">
              {% trans "年齢: " %}{{ profile.age }}
            </div>
          </div>
          <div class="row my-2">
            <div class="col">
              {% trans "母語： " %}{{ profile.get_mother_language_display }}
            </div>
          </div>
          <div class="row my-2">
            <div class="col">
              {% trans "学習言語: " %}{{ profile.get_learn_language_display }}
            </div>
          </div>
          <div class="row mt-5">
            <div class="col h3">
              {% trans "自己紹介： " %}
            </div>
          </div>
          <div class="row my-2">
            <div class="col">
              {{ profile.self_introduction }}
            </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
<div class="container">
  <div class="row">
    <div class="my-div-style w-100">
      <div class="col-lg-8 col-md-10 mx-auto">
        <div class="clearfix">
          <a class="btn btn-primary float-right my-3" href="{% url 'diary:diary_create' %}">{% trans "日記を書く" %}</a>
        </div>
                <!-- 日記リスト -->
                {% for diary, comments_list in items %}
                  <div class="card" >
                    <!-- 投稿者の情報 -->
                    <div class="card-header bg-transparent border-bottom-0">
                      <div class="row">
                        <div class="col-auto">
                          <a  href="{% url 'pages:profile' diary.user.pk %}">
                            {% if diary.user.profile_photo %}
                                <img class="rounded-circle" src="{{ diary.user.profile_photo.url }}" width="50" height="50"/>
                            {% endif %}
                          </a>
                        </div>
                        <div class="col">
                          <div class="row">
                            <div class="col-auto">
                              <b>{{ diary.user.nickname }}</b>
                            </div>
                            <div class="col">
                              <b>{{ diary.user.get_mother_language_display }}→{{ diary.user.get_learn_language_display }}</b>
                            </div>
                          </div>
                          <!-- 日記の更新日時 -->
                          <div class="row">
                            <div class="col">
                              <small>{{ diary.updated_at }}</small>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="card-body">
                      <!-- 日記のテキスト情報（タイトルはなし）　抜粋 -->
                      <p class="card-text">{{ diary.content|truncatechars:100 }}</p>
                    </div>
                    <!-- 日記写真（あれば表示、最大3） -->
                    {% if diary.photo1 %}
                      <div class="row text-center align-items-center px-1">
                        <div class="col">
                          <img src="{{ diary.photo1.url }}" class="img-fluid image" data-src="{{ diary.photo1.url }}"/>
                        </div>
                        {% if diary.photo2 %}
                          <div class="col">
                            <img src="{{ diary.photo2.url }}" class="img-fluid image" data-src="{{ diary.photo2.url }}"/>
                          </div>
                          {% if diary.photo3 %}
                            <div class="col">
                              <img src="{{ diary.photo3.url }}" class="img-fluid image" data-src="{{ diary.photo3.url }}"/>
                            </div>
                          {% endif %}
                        {% endif %}
                      </div>
                    {% endif %}

                    <!-- 日記リストフッター -->
                    <div class="card-footer bg-transparent border-top-0">
                      <div class="row justify-content-end">
                        {% if request.user.id == diary.user.id %}
                        <div class="col-auto text-right">
                          <a class="btn btn-success mt-5 mb-3" href="{% url 'diary:diary_update' diary.pk %}">{% trans "編集" %}</a>
                        </div>
                        <div class="col-auto text-right">
                          <a class="btn btn-danger mt-5 ml-2 mb-3" href="{% url 'diary:diary_delete' diary.pk %}">{% trans "削除" %}</a>
                        </div>
                        {% endif %}
                      </div>
                      <div class="row justify-content-start">
                        <!-- いいね、コメント数 -->
                        <div class="col-3">
                        {% include 'diary/like.html' %}
                        </div>
                        <div class="col-3">
                          <a class="btn btn-light border-secondary"  href="{% url 'comments:comments_create' diary.pk %}"  rel="nofollow" name="num_comment">{% trans "コメント" %} <span class="badge badge-light">{{ comments_list|length}}</span></a>
                        </div>
                        <!-- 翻訳をする -->
                        <div class="col">
                        {% include 'diary/translate.html' %}
                        </div>
                      </div>
                      <!-- コメントリスト -->
                      {% if comments_list %}
                      <div class="row mt-2 py-2 border-top">
                        コメント
                      </div>
                      {% endif %}
                      {% for comment in comments_list %}
                      <div class="row pt-2">
                        <!-- コメントユーザー写真 -->
                        <div class="col-auto">
                          <a href="{% url 'pages:profile' comment.user.pk %}">
                            {% if comment.user.profile_photo %}
                                <img class="rounded-circle" src="{{ comment.user.profile_photo.url }}" width="50" height="50"/>
                            {% endif %}
                          </a>
                        </div>
                        <div class="col">
                          <div class="row">
                            <div class="col-auto">
                              <b>{{ comment.user.nickname }}</b>
                            </div>
                            <!-- コメント日時 -->
                            <div class="col">
                              <small>{{ comment.created_at }}</small>
                            </div>
                            <div class="col">
                              {% if request.user.id == comment.user.id %}
                                <a class="btn btn-danger py-2 px-3" href="{% url 'comments:comments_delete' comment.pk %}">{% trans "削除" %}</a>
                              {% endif %}
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="row border-bottom  pb-3">
                        <div class="col">
                          <!-- コメントのテキスト情報　抜粋 -->
                          <p>{{ comment.comment_content|truncatechars:300 }}</p>
                        </div>
                        <!-- コメント写真（あれば表示） -->
                        {% if comment.photo %}
                          <div class="row align-items-center px-1">
                            <div class="col">
                              <img src="{{ comment.photo.url }}" class="img-fluid image" data-src="{{ comment.photo.url }}" width="200" height="200"/>
                            </div>
                          </div>
                        {% endif %}
                      </div>
                    {% endfor %}
                    </div>
                  </div>
                  <!-- 画像拡大用 -->
                  <div class="modal-wrapper" style="z-index: 5">
                      <img src="" alt="" class="modal-image">
                  </div>
                  <hr>
                {% empty %}
                    <p>{% trans "日記がありません。" %}</p>
                {% endfor %}

                <!-- ページネーション処理 -->
                {% include 'diary/pagination.html' %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extrajs %}
<script src="{% static 'js/script.js' %}"></script>
{% endblock %}
